<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../../assets/favcom.png" type="image/x-icon">
    <link rel="stylesheet" href="../../css/menu.css">
    <link rel="stylesheet" href="css/shared-styles.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=note_alt" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

    <title>Lista de Fretes - Mostrador</title>
</head>

<body>
    <!-- <nav class="sidebar">
        <div class="hamburger-menu">
            <div class="hamburger"></div>
        </div>
        <ul class="nav-list">
            <li>
                <a href="../../PLANILHA/lista_fretes.html">
                    <i class="fas fa-table"></i>
                    <span>Planilha</span>
                </a>
            </li>
            <li>
                <a href="../../CHAT/chat.html">
                    <i class="fas fa-comments"></i>
                    <span>Chat</span>
                </a>
            </li>
            <li>
                <a href="../../CALCULADORAS/calculadoras.html">
                    <i class="fas fa-calculator"></i>
                    <span>Calculadoras</span>
                </a>
            </li>
            <li>
                <a href="../../OC/oc.html">
                    <i class="fas fa-pencil-alt"></i>
                    <span>Ordens Manuais</span>
                </a>
            </li>
            <li>
                <a href="../../CONTATOS/contato.html">
                    <i class="fas fa-address-book"></i>
                    <span>Lista de Contatos</span>
                </a>
            </li>
            <li>
                <a href="../../MOSTRADOR/index1.html">
                    <i class="fas fa-tv"></i>
                    <span>Divulga√ß√£o</span>
                </a>
            </li>

            <li class="double-icon">
                <a href="index.html">
                    <i class="fas fa-tools"></i>
                    <span>Utilit√°rios</span>
                </a>
            </li>
            

            <li>
                <a href="../../TRACKING/indextracking.html">
                    <i class="fas fa-truck"></i>
                    <span>Tracking</span>
                </a>
            </li>
            <li>
                <a href="../../PLANILHA/dashboard.html">
                    <i class="fas fa-chart-line"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            <li>
                <a href="../../dashboard.html">
                    <i class="fas fa-home"></i>
                    <span>In√≠cio</span>
                </a>
            </li>
        </ul>
    </nav> -->

    <main class="main-content">
        <div class="page-container">
            <div class="content-wrapper">
                <div class="table-card">
                    <header class="table-header">
                        <h1>Lista de Fretes - Mostrador</h1>
                        <p class="table-subtitle">Visualiza√ß√£o e gerenciamento de fretes para exibi√ß√£o</p>
                    </header>
                    
                    <div class="table-controls">
                        <div class="table-actions">
                            <a href="index1.html" class="btn btn-secondary">
                                <span class="btn-icon">‚Üê</span>
                                Voltar
                            </a>
                            <button class="btn btn-outline" onclick="exportarParaImagem()">
                                <span class="btn-icon">üì∑</span>
                                Exportar para Imagem
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>UF</th>
                                    <th>Destino</th>
                                    <th>Valor (R$)</th>
                                    <th>Tipo</th>
                                    <th>Observa√ß√µes</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="listaFretes"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="../../js/menu.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        const fretesOriginal = JSON.parse(localStorage.getItem('fretes')) || [];
        let animationTimeout;

        function renderFretes(fretes) {
            const tbody = document.getElementById('listaFretes');
            tbody.innerHTML = '';

            fretes.forEach(frete => {
                const valor = frete.valor;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${frete.uf}</td>
                    <td>${frete.destino}</td>
                    <td>${valor !== undefined ? valor.toFixed(2).replace('.', ',') : ''}</td>
                    <td>${frete.tipo}</td>
                    <td>${frete.observacoes || ''}</td>
                    <td class="actions">
                        <button class="btn btn-primary" onclick="editarFrete(${frete.id})">
                            <span class="btn-icon">‚úèÔ∏è</span>
                            Editar
                        </button>
                        <button class="btn btn-danger" onclick="excluirFrete(${frete.id})">
                            <span class="btn-icon">üóëÔ∏è</span>
                            Excluir
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function animateRows() {
            const rows = document.querySelectorAll('tbody tr');
            rows.forEach((row, index) => {
                setTimeout(() => {
                    row.classList.add('animating');
                    setTimeout(() => {
                        row.classList.remove('animating');
                    }, 1000);
                }, index * 100);
            });
        }

        function startAnimationCycle() {
            // Limpa qualquer timeout existente
            if (animationTimeout) {
                clearTimeout(animationTimeout);
            }

            // Inicia a anima√ß√£o
            animateRows();

            // Agenda a pr√≥xima anima√ß√£o em 1 minuto
            animationTimeout = setTimeout(startAnimationCycle, 60000);
        }

        function editarFrete(id) {
            window.location.href = `index1.html?edit=${id}`;
        }

        function excluirFrete(id) {
            if (confirm('Tem certeza que deseja excluir este frete?')) {
                let fretes = JSON.parse(localStorage.getItem('fretes')) || [];
                fretes = fretes.filter(f => f.id !== id);
                localStorage.setItem('fretes', JSON.stringify(fretes));
                renderFretes(fretes);
            }
        }

        function exportarParaImagem() {
            const options = {
                scale: 2,
                useCORS: true,
                logging: false,
                onclone: function (clonedDoc) {
                    clonedDoc.querySelectorAll('.acoes-column, .botoes-acao').forEach(el => {
                        el.style.display = 'none';
                    });

                    const style = clonedDoc.createElement('style');
                    style.textContent = `
                        .container {
                            background: transparent !important;
                            box-shadow: none !important;
                        }
                        body {
                            background-image: url('../../assets/g10ok.jpeg') !important;
                            background-size: cover !important;
                            display: flex !important;
                            padding: 20px !important;
                        }
                    `;
                    clonedDoc.head.appendChild(style);
                }
            };

            html2canvas(document.querySelector(".container"), options).then(canvas => {
                const link = document.createElement('a');
                link.download = 'fretes-exportados.jpg';
                link.href = canvas.toDataURL('image/jpeg', 0.9);

                const novaJanela = window.open();
                novaJanela.document.write('<img src="' + link.href + '" style="max-width: 100%;">');
            }).catch(err => {
                console.error('Erro ao exportar:', err);
                alert('Erro ao gerar imagem. Verifique o console para detalhes.');
            });
        }

        // Inicializa a renderiza√ß√£o e o ciclo de anima√ß√£o
        renderFretes(fretesOriginal);
        startAnimationCycle();
    </script>
</body>

</html>